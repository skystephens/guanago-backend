<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>GuanaGo - San Andrés Live</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        .sidebar-categorias { 
            background: rgba(255, 255, 255, 0.95); 
            padding: 20px; 
            border-radius: 15px; 
            position: absolute; 
            top: 20px; 
            left: 20px; 
            z-index: 1; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            font-family: 'Inter', -apple-system, sans-serif;
            width: 180px;
        }
        .sidebar-categorias h4 { margin: 0 0 15px 0; color: #1a1a1a; font-size: 16px; border-bottom: 2px solid #33b5e5; padding-bottom: 5px; }
        .cat-item { margin-bottom: 8px; display: flex; align-items: center; font-size: 13px; color: #444; font-weight: 500; }
        .dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 10px; }
    </style>
</head>
<body>

<div id="map"></div>
<div class="sidebar-categorias">
    <h4>Categorías</h4>
    <div class="cat-item"><span class="dot" style="background: #E91E63"></span> Restaurante</div>
    <div class="cat-item"><span class="dot" style="background: #FF9800"></span> Alojamiento</div>
    <div class="cat-item"><span class="dot" style="background: #FFC107"></span> Hotel</div>
    <div class="cat-item"><span class="dot" style="background: #4CAF50"></span> Tienda</div>
    <div class="cat-item"><span class="dot" style="background: #00BCD4"></span> Spa</div>
    <div class="cat-item"><span class="dot" style="background: #795548"></span> Cafeteria</div>
    <div class="cat-item"><span class="dot" style="background: #F06292"></span> Heladeria</div>
    <div class="cat-item"><span class="dot" style="background: #607D8B"></span> Gasolinera</div>
    <div class="cat-item"><span class="dot" style="background: #F44336"></span> Hospital</div>
    <div class="cat-item"><span class="dot" style="background: #3F51B5"></span> Aeropuerto</div>
    <div class="cat-item"><span class="dot" style="background: #9C27B0"></span> Iglesia</div>
</div>

<script>
    // REEMPLAZA CON TU TOKEN REAL
    mapboxgl.accessToken = 'pk.eyJ1Ijoic2t5c2s4aW5nIiwiYSI6ImNqbTc1M2VncDA0a2Iza25vN2x5M29obXcifQ.RoIq-SsDb9l32j8Ydw4d2w';

    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/standard', 
        center: [-81.7100, 12.5500], // Centro exacto de la isla
        zoom: 12.5, // Un zoom ideal para ver toda la forma de la isla
        pitch: 45, // Un poco de inclinación para que se vea el relieve 3D del estilo Standard
        bearing: 0
    });

    map.on('style.load', () => {
        // Configuramos el preset "Day" para que se vea verde y claro
        map.setConfigProperty('basemap', 'lightPreset', 'day');
        
        // 2. OCULTAR los puntos de interés de Mapbox (Hoteles, tiendas, etc. ajenos a GuanaGo)
        map.setConfigProperty('basemap', 'showPointOfInterestLabels', false);
        map.setConfigProperty('basemap', 'showTransitLabels', false); // Opcional: oculta paradas de bus/ferry
        
        map.addSource('aliados', {
            type: 'geojson',
            data: '/api/v1/locations.geojson'
        });

        map.addLayer({
            'id': 'puntos-guana',
            'type': 'circle',
            'source': 'aliados',
            'paint': {
                'circle-radius': 9,
                'circle-stroke-width': 2,
                'circle-stroke-color': '#ffffff',
                'circle-color': [
                    'match',
                    ['get', 'categoria'],
                    'Restaurante', '#E91E63',
                    'Actividad', '#2196F3',
                    'Tienda', '#4CAF50',
                    'Alojamiento', '#FF9800',
                    'Otros', '#9C27B0',
                    '#9C27B0' // Color por defecto si no coincide nada
                ]
            }
        });

        // GPS en tiempo real
        map.addControl(new mapboxgl.GeolocateControl({
            positionOptions: { enableHighAccuracy: true },
            trackUserLocation: true,
            showUserHeading: true
        }));
    });

    // Popups al hacer clic
    map.on('click', 'puntos-guana', (e) => {
        const props = e.features[0].properties;
        new mapboxgl.Popup()
            .setLngLat(e.lngLat)
            .setHTML(`
                <div style="padding:10px;">
                    <h3 style="margin:0; color:#33b5e5;">${props.storeName}</h3>
                    <p><b>Plan:</b> ${props.plan}</p>
                    <p><small>Ubicación certificada por GuanaGo</small></p>
                </div>
            `)
            .addTo(map);
    });

    map.on('mouseenter', 'puntos-guana', () => map.getCanvas().style.cursor = 'pointer');
    map.on('mouseleave', 'puntos-guana', () => map.getCanvas().style.cursor = '');
</script>

</body>
</html>